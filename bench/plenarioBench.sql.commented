# For an example pgbench script, take a look at
# http://www.postgresql.org/docs/9.4/static/pgbench.html

# We'll vary the time window for 4 of the 6 queries
\setrandom chicago_year 2007 2014
\setrandom all_year 2010 2015
\setrandom specific_datasets_start_year 2007 2013
\set specific_datasets_end_year 1 + :specific_datasets_start_year
\setrandom 311_start_year 2007 2014
\set 311_end_year 1 + :311_start_year

BEGIN;
# /timeseries in a (Chicago) polygon. Group by week.
# http://plenar.io/v1/api/timeseries/?obs_date__le=2014%2F08%2F20&obs_date__ge=2014%2F02%2F21&location_geom__within=%7B%22type%22%3A%22Feature%22%2C%22properties%22%3A%7B%7D%2C%22geometry%22%3A%7B%22type%22%3A%22Polygon%22%2C%22coordinates%22%3A%5B%5B%5B-87.65692949295044%2C41.86853817536259%5D%2C%5B-87.65692949295044%2C41.89716623689334%5D%2C%5B-87.62053728103638%2C41.89716623689334%5D%2C%5B-87.62053728103638%2C41.86853817536259%5D%2C%5B-87.65692949295044%2C41.86853817536259%5D%5D%5D%7D%7D&agg=week
# Vary year, 2007 on
SELECT date_trunc('week', dat_master.obs_date) AS date_trunc_1, count(dat_master.obs_date) AS count_1, dat_master.dataset_name AS dat_master_dataset_name
	FROM dat_master
	WHERE dat_master.current_flag = true AND dat_master.dataset_name IN ('cta_ridership_avg_weekday_bus_stop_boardings_in_oc', '2003_campaign_expenditures', 'economic_development_compliance_chapter_380_agreem', 'food_inspections', 'entries_csv', 'mayors_24_hour_hotline_cases_created_last_90_days', '311_service_requests_alley_lights_out', 'crime_csv', 'graffiti_30_days', 'idol_public_works_prohibited_contractors', '311_service_requests_vacant_and_abandoned_building', 'average_daily_traffic_counts', 'street_tree_list', 'disabled_parking', 'crime_incident_reports', 'credit_access_businesses', '311_service_requests_pot_holes_reported', 'cdph_environmental_permits', 'iema_non_dental_facilities_in_illinois_with_radiat', '311_service_requests_abandoned_vehicles', '2013_campaign_contributions', '2013_ecad_multi_family_energy_audit_and_eui_data', 'graffiti', 'nyc_service_volunteer_opportunities', '2013_campaign_expenditures', 'lapd_crime_and_collision_raw_data_2014', 'cdph_environmental_inspections', 'mayors_24_hour_hotline_nemo_snow_related_calls', 'building_permits_since_2009', 'ci4x0rtb9000h02tcfa5qov33_csv', 'child_care_regulated_programs', '311_service_requests_street_lights_all_out', '311_unified_data', '2001_campaign_expenditures', 'capital_improvement_passthrough_petitions', '311_service_requests_2009', '311_service_requests_for_2008', 'flu_shot_clinic_locations_2013', 'flu_shot_clinic_locations_2013_standard_format', 'apd_incident_extract_2010', 'july_is_love_my_parks_month', '2005_campaign_expenditures', 'universal_pre_k_upk_school_locations', '2001_campaign_contributions', 'apd_incident_extract_2011', 'curb_ramps', 'landlord_utility_passthroughs', 'iema_dental_facilities_in_illinois', 'new_york_s_great_appliance_swap_out', '2009_campaign_expenditures', 'liquor_authority_quarterly_list_of_active_licenses', 'capital_projects_nys_thruway_authority_capital_pro', '311_service_requests_for_2006', '311_service_requests_for_2007', 'operating_and_maintenance_petitions', 'lapd_crime_and_collision_raw_data_for_2013', '311_service_requests_tree_trims', 'apd_incident_extract_2008', '2005_campaign_contributions', 'mayor_s_24_hour_hotline_service_requests', 'apd_incident_extract_2009', 'state_university_construction_fund_sucf_contracts_', 'cook_county_recorder_of_deeds_mortgages_2012_janua', 'sfpd_incident_all_datetime_csv', 'solar_photovoltaic_pv_incentive_program_beginning_', '2003_campaign_contributions', 'nypd_motor_vehicle_collisions', 'individual_landmarks', 'bird_conservation_areas', 'city_of_champaign_historic_landmarks', '2009_campaign_contributions', '311_service_requests_sanitation_code_complaints', 'duplicate_human_waste', 'business_licenses', 'graffiti_30_days', 'ecad_commercial_portfolio_manager_reported_data_20', 'apd_incident_extract_ytd', 'micro_market_recovery_program_cases', 'environmental_control_asbestos_abatement_permits_2', 'cdph_environmental_complaints', 'idol_public_works_prohibited_contractors', '311_service_requests_graffiti_removal', 'market_street_hub', 'water_quality_sampling_data', 'cook_county_recorder_of_deeds_foreclosures_2011_co', 'chicago_redlight_tickets_csv', 'liquor_authority_quarterly_list_of_active_licenses', 'advantage_after_school_program', 'building_permits', '311_service_requests_rodent_baiting', 'cdph_environmental_hold_on_city_issued_permits_and', 'cook_county_recorder_of_deeds_mortgages_2011_compl', 'cook_county_recorder_of_deeds_foreclosures_2012_ja', '311_service_requests_street_lights_one_out', 'street_tree_list', 'graffiti', 'environmental_control_asbestos_demolition_permits_', 'micro_market_recovery_program_violations_and_inspe', 'micro_market_recovery_program_permits') AND ST_Within(dat_master.location_geom, ST_GeomFromGeoJSON('{"crs": {"type": "name", "properties": {"name": "EPSG:4326"}}, "type": "Polygon", "coordinates": [[[-87.65692949295044, 41.86853817536259], [-87.65692949295044, 41.89716623689334], [-87.62053728103638, 41.89716623689334], [-87.62053728103638, 41.86853817536259], [-87.65692949295044, 41.86853817536259]]]}')) AND dat_master.obs_date >= ':chicago_year/02/21' AND dat_master.obs_date <= ':chicago_year/08/20' GROUP BY dat_master.dataset_name, date_trunc('week', dat_master.obs_date) ORDER BY date_trunc('week', dat_master.obs_date);
# Count available datasets from Feb 21 to Aug 20 aggregated by week in CSV format.
# http://plenar.io/v1/api/timeseries/?obs_date__le=2014%2F08%2F20&obs_date__ge=2014%2F02%2F21&agg=week&data_type=csv
# Vary year, 2010 on
SELECT date_trunc('week', dat_master.obs_date) AS date_trunc_1, count(dat_master.obs_date) AS count_1, dat_master.dataset_name AS dat_master_dataset_name
	FROM dat_master
	WHERE dat_master.current_flag = true AND dat_master.dataset_name IN ('cta_ridership_avg_weekday_bus_stop_boardings_in_oc', '2003_campaign_expenditures', 'economic_development_compliance_chapter_380_agreem', 'food_inspections', 'entries_csv', 'mayors_24_hour_hotline_cases_created_last_90_days', '311_service_requests_alley_lights_out', 'crime_csv', 'graffiti_30_days', 'idol_public_works_prohibited_contractors', '311_service_requests_vacant_and_abandoned_building', 'average_daily_traffic_counts', 'street_tree_list', 'disabled_parking', 'crime_incident_reports', 'credit_access_businesses', '311_service_requests_pot_holes_reported', 'cdph_environmental_permits', 'iema_non_dental_facilities_in_illinois_with_radiat', '311_service_requests_abandoned_vehicles', '2013_campaign_contributions', '2013_ecad_multi_family_energy_audit_and_eui_data', 'graffiti', 'nyc_service_volunteer_opportunities', '2013_campaign_expenditures', 'lapd_crime_and_collision_raw_data_2014', 'cdph_environmental_inspections', 'mayors_24_hour_hotline_nemo_snow_related_calls', 'building_permits_since_2009', 'ci4x0rtb9000h02tcfa5qov33_csv', 'child_care_regulated_programs', '311_service_requests_street_lights_all_out', '311_unified_data', '2001_campaign_expenditures', 'capital_improvement_passthrough_petitions', '311_service_requests_2009', '311_service_requests_for_2008', 'flu_shot_clinic_locations_2013', 'flu_shot_clinic_locations_2013_standard_format', 'apd_incident_extract_2010', 'july_is_love_my_parks_month', '2005_campaign_expenditures', 'universal_pre_k_upk_school_locations', '2001_campaign_contributions', 'apd_incident_extract_2011', 'curb_ramps', 'landlord_utility_passthroughs', 'iema_dental_facilities_in_illinois', 'new_york_s_great_appliance_swap_out', '2009_campaign_expenditures', 'liquor_authority_quarterly_list_of_active_licenses', 'capital_projects_nys_thruway_authority_capital_pro', '311_service_requests_for_2006', '311_service_requests_for_2007', 'operating_and_maintenance_petitions', 'lapd_crime_and_collision_raw_data_for_2013', '311_service_requests_tree_trims', 'apd_incident_extract_2008', '2005_campaign_contributions', 'mayor_s_24_hour_hotline_service_requests', 'apd_incident_extract_2009', 'state_university_construction_fund_sucf_contracts_', 'cook_county_recorder_of_deeds_mortgages_2012_janua', 'sfpd_incident_all_datetime_csv', 'solar_photovoltaic_pv_incentive_program_beginning_', '2003_campaign_contributions', 'nypd_motor_vehicle_collisions', 'individual_landmarks', 'bird_conservation_areas', 'city_of_champaign_historic_landmarks', '2009_campaign_contributions', '311_service_requests_sanitation_code_complaints', 'duplicate_human_waste', 'business_licenses', 'graffiti_30_days', 'ecad_commercial_portfolio_manager_reported_data_20', 'apd_incident_extract_ytd', 'micro_market_recovery_program_cases', 'environmental_control_asbestos_abatement_permits_2', 'cdph_environmental_complaints', 'idol_public_works_prohibited_contractors', '311_service_requests_graffiti_removal', 'market_street_hub', 'water_quality_sampling_data', 'cook_county_recorder_of_deeds_foreclosures_2011_co', 'chicago_redlight_tickets_csv', 'liquor_authority_quarterly_list_of_active_licenses', 'advantage_after_school_program', 'building_permits', '311_service_requests_rodent_baiting', 'cdph_environmental_hold_on_city_issued_permits_and', 'cook_county_recorder_of_deeds_mortgages_2011_compl', 'cook_county_recorder_of_deeds_foreclosures_2012_ja', '311_service_requests_street_lights_one_out', 'street_tree_list', 'graffiti', 'environmental_control_asbestos_demolition_permits_', 'micro_market_recovery_program_violations_and_inspe', 'micro_market_recovery_program_permits') AND dat_master.obs_date >= ':all_year/02/21' AND dat_master.obs_date <= ':all_year/08/20' GROUP BY dat_master.dataset_name, date_trunc('week', dat_master.obs_date) ORDER BY date_trunc('week', dat_master.obs_date);
# /detail grab all homicides in Chicago
# http://plenar.io/v1/api/detail-aggregate/?dataset_name=crimes_2001_to_present&obs_date__ge=2001-01-01&iucr=0110&arrest=yes&agg=month
SELECT date_trunc('month', dat_master.obs_date) AS date_trunc_1, count(dat_master.dataset_row_id) AS count_1
	FROM dat_master JOIN dat_crimes_2001_to_present ON dat_master.dataset_row_id = dat_crimes_2001_to_present.crimes_2001_to_present_row_id
	WHERE dat_master.obs_date >= '2001-01-01' AND dat_master.dataset_name = 'crimes_2001_to_present' AND dat_crimes_2001_to_present.arrest = 'yes' AND dat_crimes_2001_to_present.iucr = '0110' GROUP BY date_trunc('month', dat_master.obs_date) ORDER BY date_trunc('month', dat_master.obs_date);
# /timeseries looking at two datasets specifically (both in Chicago). Group by day.
# http://plenar.io/v1/api/timeseries/?obs_date__ge=2007-11-12&obs_date__le=2008-11-12&dataset_name__in=crimes_2001_to_present,cdph_environmental_complaints&agg=day
# vary year, 2007-2008 on
SELECT date_trunc('day', dat_master.obs_date) AS date_trunc_1, count(dat_master.obs_date) AS count_1, dat_master.dataset_name AS dat_master_dataset_name
	FROM dat_master
	WHERE dat_master.current_flag = true AND dat_master.dataset_name IN ('crimes_2001_to_present', 'cdph_environmental_complaints') AND dat_master.obs_date >= ':specific_datasets_start_year-11-12' AND dat_master.obs_date <= ':specific_datasets_end_year-11-12' GROUP BY dat_master.dataset_name, date_trunc('day', dat_master.obs_date) ORDER BY date_trunc('day', dat_master.obs_date);
# /timeseries over San Francisco
# http://plenar.io/v1/api/timeseries/?obs_date__ge=2009-09-23&obs_date__le=2014-09-23&location_geom__within={"type":"Feature","properties":{},"geometry":{"type":"Polygon","coordinates":[[[-122.401578,37.789505],[-122.408573,37.784113],[-122.401857,37.77889],[-122.394948,37.784351],[-122.401578,37.789506]]]}}&agg=week
SELECT date_trunc('week', dat_master.obs_date) AS date_trunc_1, count(dat_master.obs_date) AS count_1, dat_master.dataset_name AS dat_master_dataset_name
	FROM dat_master
	WHERE dat_master.current_flag = true AND dat_master.dataset_name IN ('cta_ridership_avg_weekday_bus_stop_boardings_in_oc', '2003_campaign_expenditures', 'economic_development_compliance_chapter_380_agreem', 'food_inspections', 'entries_csv', 'mayors_24_hour_hotline_cases_created_last_90_days', '311_service_requests_alley_lights_out', 'crime_csv', 'graffiti_30_days', 'idol_public_works_prohibited_contractors', '311_service_requests_vacant_and_abandoned_building', 'average_daily_traffic_counts', 'street_tree_list', 'disabled_parking', 'crime_incident_reports', 'credit_access_businesses', '311_service_requests_pot_holes_reported', 'cdph_environmental_permits', 'iema_non_dental_facilities_in_illinois_with_radiat', '311_service_requests_abandoned_vehicles', '2013_campaign_contributions', '2013_ecad_multi_family_energy_audit_and_eui_data', 'graffiti', 'nyc_service_volunteer_opportunities', '2013_campaign_expenditures', 'lapd_crime_and_collision_raw_data_2014', 'cdph_environmental_inspections', 'mayors_24_hour_hotline_nemo_snow_related_calls', 'building_permits_since_2009', 'ci4x0rtb9000h02tcfa5qov33_csv', 'child_care_regulated_programs', '311_service_requests_street_lights_all_out', '311_unified_data', '2001_campaign_expenditures', 'capital_improvement_passthrough_petitions', '311_service_requests_2009', '311_service_requests_for_2008', 'flu_shot_clinic_locations_2013', 'flu_shot_clinic_locations_2013_standard_format', 'apd_incident_extract_2010', 'july_is_love_my_parks_month', '2005_campaign_expenditures', 'universal_pre_k_upk_school_locations', '2001_campaign_contributions', 'apd_incident_extract_2011', 'curb_ramps', 'landlord_utility_passthroughs', 'iema_dental_facilities_in_illinois', 'new_york_s_great_appliance_swap_out', '2009_campaign_expenditures', 'liquor_authority_quarterly_list_of_active_licenses', 'capital_projects_nys_thruway_authority_capital_pro', '311_service_requests_for_2006', '311_service_requests_for_2007', 'operating_and_maintenance_petitions', 'lapd_crime_and_collision_raw_data_for_2013', '311_service_requests_tree_trims', 'apd_incident_extract_2008', '2005_campaign_contributions', 'mayor_s_24_hour_hotline_service_requests', 'apd_incident_extract_2009', 'state_university_construction_fund_sucf_contracts_', 'cook_county_recorder_of_deeds_mortgages_2012_janua', 'sfpd_incident_all_datetime_csv', 'solar_photovoltaic_pv_incentive_program_beginning_', '2003_campaign_contributions', 'nypd_motor_vehicle_collisions', 'individual_landmarks', 'bird_conservation_areas', 'city_of_champaign_historic_landmarks', '2009_campaign_contributions', '311_service_requests_sanitation_code_complaints', 'duplicate_human_waste', 'business_licenses', 'graffiti_30_days', 'ecad_commercial_portfolio_manager_reported_data_20', 'apd_incident_extract_ytd', 'micro_market_recovery_program_cases', 'environmental_control_asbestos_abatement_permits_2', 'cdph_environmental_complaints', 'idol_public_works_prohibited_contractors', '311_service_requests_graffiti_removal', 'market_street_hub', 'water_quality_sampling_data', 'cook_county_recorder_of_deeds_foreclosures_2011_co', 'chicago_redlight_tickets_csv', 'liquor_authority_quarterly_list_of_active_licenses', 'advantage_after_school_program', 'building_permits', '311_service_requests_rodent_baiting', 'cdph_environmental_hold_on_city_issued_permits_and', 'cook_county_recorder_of_deeds_mortgages_2011_compl', 'cook_county_recorder_of_deeds_foreclosures_2012_ja', '311_service_requests_street_lights_one_out', 'street_tree_list', 'graffiti', 'environmental_control_asbestos_demolition_permits_', 'micro_market_recovery_program_violations_and_inspe', 'micro_market_recovery_program_permits') AND ST_Within(dat_master.location_geom, ST_GeomFromGeoJSON('{"crs": {"type": "name", "properties": {"name": "EPSG:4326"}}, "type": "Polygon", "coordinates": [[[-122.401578, 37.789505], [-122.408573, 37.784113], [-122.401857, 37.77889], [-122.394948, 37.784351], [-122.401578, 37.789506]]]}')) AND dat_master.obs_date >= '2009-09-23' AND dat_master.obs_date <= '2014-09-23' GROUP BY dat_master.dataset_name, date_trunc('week', dat_master.obs_date) ORDER BY date_trunc('week', dat_master.obs_date);
# /timeseries filtering by dataset name like 311
# http://plenar.io/v1/api/timeseries/?obs_date__ge=2014-01-01&dataset_name__ilike=%25311%25&agg=week
# Vary year, 2007 - 2008 on
SELECT date_trunc('week', dat_master.obs_date) AS date_trunc_1, count(dat_master.obs_date) AS count_1, dat_master.dataset_name AS dat_master_dataset_name
	FROM dat_master
	WHERE dat_master.current_flag = true AND dat_master.dataset_name IN ('cta_ridership_avg_weekday_bus_stop_boardings_in_oc', '2003_campaign_expenditures', 'economic_development_compliance_chapter_380_agreem', 'food_inspections', 'entries_csv', 'mayors_24_hour_hotline_cases_created_last_90_days', '311_service_requests_alley_lights_out', 'crime_csv', 'graffiti_30_days', 'idol_public_works_prohibited_contractors', '311_service_requests_vacant_and_abandoned_building', 'average_daily_traffic_counts', 'street_tree_list', 'disabled_parking', 'crime_incident_reports', 'credit_access_businesses', '311_service_requests_pot_holes_reported', 'cdph_environmental_permits', 'iema_non_dental_facilities_in_illinois_with_radiat', '311_service_requests_abandoned_vehicles', '2013_campaign_contributions', '2013_ecad_multi_family_energy_audit_and_eui_data', 'graffiti', 'nyc_service_volunteer_opportunities', '2013_campaign_expenditures', 'lapd_crime_and_collision_raw_data_2014', 'cdph_environmental_inspections', 'mayors_24_hour_hotline_nemo_snow_related_calls', 'building_permits_since_2009', 'ci4x0rtb9000h02tcfa5qov33_csv', 'child_care_regulated_programs', '311_service_requests_street_lights_all_out', '311_unified_data', '2001_campaign_expenditures', 'capital_improvement_passthrough_petitions', '311_service_requests_2009', '311_service_requests_for_2008', 'flu_shot_clinic_locations_2013', 'flu_shot_clinic_locations_2013_standard_format', 'apd_incident_extract_2010', 'july_is_love_my_parks_month', '2005_campaign_expenditures', 'universal_pre_k_upk_school_locations', '2001_campaign_contributions', 'apd_incident_extract_2011', 'curb_ramps', 'landlord_utility_passthroughs', 'iema_dental_facilities_in_illinois', 'new_york_s_great_appliance_swap_out', '2009_campaign_expenditures', 'liquor_authority_quarterly_list_of_active_licenses', 'capital_projects_nys_thruway_authority_capital_pro', '311_service_requests_for_2006', '311_service_requests_for_2007', 'operating_and_maintenance_petitions', 'lapd_crime_and_collision_raw_data_for_2013', '311_service_requests_tree_trims', 'apd_incident_extract_2008', '2005_campaign_contributions', 'mayor_s_24_hour_hotline_service_requests', 'apd_incident_extract_2009', 'state_university_construction_fund_sucf_contracts_', 'cook_county_recorder_of_deeds_mortgages_2012_janua', 'sfpd_incident_all_datetime_csv', 'solar_photovoltaic_pv_incentive_program_beginning_', '2003_campaign_contributions', 'nypd_motor_vehicle_collisions', 'individual_landmarks', 'bird_conservation_areas', 'city_of_champaign_historic_landmarks', '2009_campaign_contributions', '311_service_requests_sanitation_code_complaints', 'duplicate_human_waste', 'business_licenses', 'graffiti_30_days', 'ecad_commercial_portfolio_manager_reported_data_20', 'apd_incident_extract_ytd', 'micro_market_recovery_program_cases', 'environmental_control_asbestos_abatement_permits_2', 'cdph_environmental_complaints', 'idol_public_works_prohibited_contractors', '311_service_requests_graffiti_removal', 'market_street_hub', 'water_quality_sampling_data', 'cook_county_recorder_of_deeds_foreclosures_2011_co', 'chicago_redlight_tickets_csv', 'liquor_authority_quarterly_list_of_active_licenses', 'advantage_after_school_program', 'building_permits', '311_service_requests_rodent_baiting', 'cdph_environmental_hold_on_city_issued_permits_and', 'cook_county_recorder_of_deeds_mortgages_2011_compl', 'cook_county_recorder_of_deeds_foreclosures_2012_ja', '311_service_requests_street_lights_one_out', 'street_tree_list', 'graffiti', 'environmental_control_asbestos_demolition_permits_', 'micro_market_recovery_program_violations_and_inspe', 'micro_market_recovery_program_permits') AND dat_master.obs_date >= ':311_start_year-01-01' AND dat_master.obs_date <= ':311_start_year-10-12' AND dat_master.dataset_name ILIKE '%311%' GROUP BY dat_master.dataset_name, date_trunc('week', dat_master.obs_date) ORDER BY date_trunc('week', dat_master.obs_date);
END;
