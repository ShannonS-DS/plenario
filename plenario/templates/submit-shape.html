{% extends 'submit-dataset.html' %}
{% from "macros/contributor-form.html" import contributor_form %}
{% from "macros/metadata-form-fragment.html" import metadata_form_fragment %}

{% set is_shape=True %}

{% block headline %}
    Submit a new shapefile.
{% endblock headline %}

{% block submission %}

    <p><em><span class="red">*</span> denotes a required field</em></p>

     <h3>Link to a shapefile</h3>
            {% block fetch_details %}
            <form role="form" method="GET" id="fetch-details-form">
                <div class="form-group">
                    {% if dataset_info %}
                    <input type="text" class="form-control" name="dataset_url" value="{{dataset_info.submitted_url}}" />
                    {% else %}
                    <input type="text" class="form-control" name="dataset_url" placeholder="http://data.mycity.gov/path/to/file.csv"/>
                    {% endif %}
                    <p class="help-block">Publicly available URL for a data source in CSV format or a Socrata dataset.</p>
                </div>
                <div class="form-group">
                    <button class="btn btn-info" type="submit">Fetch details &raquo;</button>
                </div>
            </form>
            {% endblock fetch_details %}

              {% if dataset_info %}
                    <hr />
                    <div class="row">
                        <div class="col-md-10 col-md-offset-1">
                            <form role="form" class="form" method="POST">
                                <div id="errors" class="alert alert-danger alert-dismissible" role="alert" style="display: none;">
                                    <button type="button" class="close" data-dismiss="alert">
                                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                    </button>
                                    <p><strong>There were some errors with your submission:</strong></p>
                                    <p id="error-list"></p>
                                </div>

                                {{ metadata_form_fragment(dataset_info) }}

                                {{ contributor_form(submit_button_verb, dataset_info) }}

                                <hr />
                                <p>
                                    <button type="submit" class="btn btn-success" id="datatype-submit">
                                      Submit &raquo;
                                    </button>
                                </p>
                            </form>
                        </div>
                    </div>
              {% endif %}
{% endblock submission %}

{% block extra_javascript %}
    <script src="{{ url_for('static', filename='js/validator.js') }}"></script>
{% endblock extra_javascript %}

{% macro bootstrap_validate_field(type, name, description, placeholder, help_message, error_message) %}
    <div class="form-group">
        <label for="{{ name }}" class="control-label"><span class="red">*</span>{{ description }}</label>
        <input type="{{ type }}" class="form-control"
               data-error="{{ error_message }}" name="{{ name }}" placeholder="{{ placeholder }}" required>
        <p class="help-block with-errors">{{ help_message }}</p>
    </div>
{% endmacro %}